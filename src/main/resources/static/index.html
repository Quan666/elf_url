<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ELF短链</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">

    <link rel="stylesheet" type="text/css" href="css/buttons.css" />
    <link rel="stylesheet" type="text/css" href="css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.2.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="css/set2.css" />
    <link rel="stylesheet" type="text/css" href="css/demo.css" />

    <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style type="text/css">
        textarea{
            font-size: 16px;
        }
        .footer {
            height: 50px;
            margin-bottom: -50px;
        }
    </style>
</head>
<body>
<div class="container">
    <br>
    <br>
    <h3>ELF 短链</h3>
    <p id="MessageText">在下方方框内输入需要缩短的链接</p>
    <section class="content bgcolor-1">
  	<span class="input input--nao">
		<input class="input__field input__field--nao" type="text" id="url"/>
		<label class="input__label input__label--nao" for="url">
			<span class="input__label-content input__label-content--nao" id="ExampleText">example：https://myelf.club</span>
		</label>
		<svg class="graphic graphic--nao" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">
			<path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"/>
		</svg>
 	</span>
    <span id="SpanPasswd" class="input input--nao" hidden>
		<input class="input__field input__field--nao" type="text" id="Passwd"/>
		<label class="input__label input__label--nao" for="url">
			<span class="input__label-content input__label-content--nao" id="ExampleTextPasswd">PassWorld</span>
		</label>
		<svg class="graphic graphic--nao" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">
			<path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"/>
		</svg>
 	</span>

        <div  id="show_uri" style="display: none;visibility:hidden">
            <div class="input-group mb-3">
                <input id="uri" class="form-control" type="text">
                <div class="input-group-prepend">
                    <button class="btn btn-outline-secondary" type="button" data-clipboard-demo="" data-clipboard-target="#uri" data-toggle="tooltip" data-placement="top" title="点我复制">
                        <img class="clippy" src="img/clippy.svg" width="15" alt="复制到剪贴板">
                    </button>
                </div>
            </div>
            <center><div id="qr"></div></center>
        </div>

    </section>
    <br>
    <button onclick="getELF_URL(this)" id="getBtn" value="short" class="button button-rounded button-primary button-large">生成短链</button>
    <br>
    <br>
    <div class="button-group">
        <button onclick="changeBtn(this)" value="cipher" class="button button-rounded button-group button-action button-small">一言密语</button>
        <button onclick="changeBtn(this)" value="oneread" class="button button-rounded button-group button-highlight button-small">阅后即焚</button>
    </div>
</div>
<br><br><br>
<footer class="container footer">
    <div>© 2020 Copyright by <a href="https://myelf.club">MYELF</a>

    </div>
    <div><a target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=NVx1R1pHXBtQWFRcWQ" style="text-decoration:none;"><img src="http://rescdn.qqmail.com/zh_CN/htmledition/images/function/qm_open/ico_mailme_01.png"/></a></div>
</footer>

<script src="js/QRCode_files/modernizr-2.8.3.js" type="text/javascript"></script>
<script type="text/javascript" src="js/QRCode_files/qrcode.min.js"></script>
<script src="js/classie.js"></script>
<script src="js/clipboard.min.js"></script>
<script src="js/Ajax.js"></script>
<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>
    function getELF_URL(btn){
        var value=document.getElementById("url").value;
        if(value.length<=0){
            alert("请输入内容！");
            return;
        }
        var obj={};
        switch (btn.value) {
            case "cipher":
                obj.message = document.getElementById("url").value;
                obj.passwd = document.getElementById("Passwd").value;
                if(obj.passwd<=0){
                    alert("请输入密码！");
                    return;
                }
                AjaxPostLoadXML('/cipher/insert',obj,showuri);
                break;
            case "oneread":
                obj.message = document.getElementById("url").value;
                AjaxPostLoadXML('/oneread/insert',obj,showuri);
                break;
            case "short":
                obj.url = document.getElementById("url").value;
                AjaxPostLoadXML('/url/insert',obj,showuri);
                break;
        }
    }

    function showuri(obj){
        if(obj.code==1){
            document.getElementById("uri").value=obj.data.shortUrl;
            document.getElementById("show_uri").style.display="";
            document.getElementById("show_uri").style.visibility="visible";
            setlink(obj.data.shortUrl);
        }else {
            alert("添加失败！");
        }
    }

    function changeBtn(btn) {
        switch (btn.value) {
            case "cipher":
                var oldBtn = document.getElementById("getBtn").value;
                document.getElementById("getBtn").value="cipher";
                btn.value = oldBtn;
                btn.innerText=document.getElementById("getBtn").innerText;
                document.getElementById("getBtn").innerText="一言密语";
                document.getElementById("ExampleText").innerText="example：I Love You！";
                document.getElementById("MessageText").innerText="在下方方框内输入你的密语";
                document.getElementById("SpanPasswd").removeAttribute("hidden");
                break;
            case "oneread":
                var oldBtn = document.getElementById("getBtn").value;
                document.getElementById("getBtn").value="oneread";
                btn.value = oldBtn;
                btn.innerText=document.getElementById("getBtn").innerText;
                document.getElementById("getBtn").innerText="阅后即焚";
                document.getElementById("ExampleText").innerText="example：I Love You！";
                document.getElementById("MessageText").innerText="在下方方框内输入阅后即焚内容";
                document.getElementById("SpanPasswd").setAttribute("hidden",true);
                break;
            case "short":
                var oldBtn = document.getElementById("getBtn").value;
                document.getElementById("getBtn").value="short";
                btn.value = oldBtn;
                btn.innerText=document.getElementById("getBtn").innerText;
                document.getElementById("getBtn").innerText="生成短链";
                document.getElementById("ExampleText").innerText="example：https://myelf.club";
                document.getElementById("MessageText").innerText="在下方方框内输入需要缩短的链接";
                document.getElementById("SpanPasswd").setAttribute("hidden",true);
                break;
        }
    }

</script>
<script>

    function downloadFile(link){
        var url=link;
        window.href=url;
    }

    //判断是否为网址并将其中的中文转码
    function ChangeUrl(str){
        var patt = new RegExp("http[s]?://");
        if(patt.test(str)){
            str=encodeURI(str);
        };
        return str;
    }
    var qrcode = new QRCode('qr', {
        text: 'https://myelf.club',
        width: 180,
        height: 180,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
    });

    function setlink(link){
        qrcode.clear();
        qrcode.makeCode(ChangeUrl(link));
    }

    (function() {
        // trim polyfill : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim
        if (!String.prototype.trim) {
            (function() {
                // Make sure we trim BOM and NBSP
                var rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
                String.prototype.trim = function() {
                    return this.replace(rtrim, '');
                };
            })();
        }

        [].slice.call( document.querySelectorAll( 'input.input__field' ) ).forEach( function( inputEl ) {
            // in case the input is already filled..
            if( inputEl.value.trim() !== '' ) {
                classie.add( inputEl.parentNode, 'input--filled' );
            }

            // events:
            inputEl.addEventListener( 'focus', onInputFocus );
            inputEl.addEventListener( 'blur', onInputBlur );
        } );

        function onInputFocus( ev ) {
            classie.add( ev.target.parentNode, 'input--filled' );
        }

        function onInputBlur( ev ) {
            if( ev.target.value.trim() === '' ) {
                classie.remove( ev.target.parentNode, 'input--filled' );
            }
        }
    })();
</script>


<script>
    var clipboard = new ClipboardJS('.btn');
    clipboard.on('success', function(e) {
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        alert("复制成功！");
        e.clearSelection();
    });

    clipboard.on('error', function(e) {
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
    });
</script>
<script>
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>
</body>
</html>